### 数据库索引

什么是数据库的索引, 图书馆的书就类似我们数据库表中的数据, 楼层索引排, 书架分类标识, 索书号就类似我们查找数据的索引.索引也可以理解为一本书的目录 .而当用户通过目录查询某个章节的某个知识点, ,所以可以有效的提高数据库系统的整体性能.那我们常用的数据库的索引底层的数据结构是什么样的.要了解数据库索引的底层原理,我们就得先了解一种叫树的数据结构, 而树中很经典的一种数据结构就是二叉树.

评价一个数据结构作为索引的优劣最重要的指标就是在查找过程中磁盘IO操作次数的渐进负杂度.

换句话说, 索引的结构组织要尽量减少查找过程中磁盘IO的存取次数.

### 二叉树(binary search trees)

二叉树是每个结点最多有两个子树的树结构。通常子树被称作“左子树”（left subtree）和“右子树”（right subtree）。二叉树常被用于实现二叉查找树和二叉堆.

### b-树

其实从算法逻辑上来讲, 二叉查找树的查找速度和比较次数都是最小的,但是, 我们不得不考虑一个现实问题:磁盘IO,数据库索引是存储在磁盘上的, 当数据量比较大的时候, 索引的大小可能有几个G甚至更多.当我们利用索引查询的时候, 能把整个索引全部加载到内存吗, 显然不可能, 能做的只有逐一加载每一个磁盘页, 这里的磁盘页对应着索引树的节点,

所以,最坏情况下, 磁盘IO次数等于索引树的高度,没错,既然如此,为了减少磁盘IO的次数, 我们就需要把原本"廋高"的树结构变的矮胖.这就是b-树的特征之一.b树是一种多路的平衡查找树, 他的每一个节点最多包含k个孩子,k被称为b树的阶.k的大小取决于磁盘页的大小. 

b-树在查询中的比较次数其实不比二叉查找树少, 尤其当单一节点中的元素量很多时,可是相比磁盘IO的速度, 内存中的比较耗时几乎可以忽略.所以只要树的高度足够低, IO次数就足够少,就可以提升查找性能.相比之下节点内部元素多一些也没有关系,仅仅是多了几次内存交互,只要不超过磁盘页的大小即可,这就是b-树的优势之一.b-树的一大优势就是自平衡.

b-树主要应用于文件系统以及部分数据库索引, 比如著名的非关系型数据库Mongodb.而大部分关系型数据库,比如mysql, 则使用b+树作为索引.

### b+树

b+ 树是基于b-树的一种变体,有着比b-树更高的查询性能.

### 平衡二叉树

平衡二叉树是基于二分法的策略提高数据的查找速度的二叉树的数据结构

---

第一讲: 基础架构:一条sql查询语句是如何执行的.

```mysql
mysql> select * from T where ID=10
```

![各个模块的执行过程](https://static001.geekbang.org/resource/image/0d/d9/0d2070e8f84c4801adbfa03bda1f98d9.png)

大体来说, mysql可以分为server层和存储引擎层两部分.

server层包括连接器, 查询缓存, 分析器, 优化器, 执行器等, 涵盖mysql的大多数核心服务功能, 以及所有的内置函数(如日期, 时间, 数学和加密函数等), 所有跨存储引擎的功能都在这一层实现, 比如存储过程,触发器吗视图等.

而存储引擎层负责数据的存储和提取 .其架构模式是插件式的, 支持innodb, mylsam, memory等多个存储引擎.现在常用的存储引擎是innodb, 它从mysql 5.5.5 版本开始成为了默认存储引擎.

也就是说, 你执行create table 建表的时候, 如果不指定引擎类型, 默认使用的就是innodb.不过你也可以通过指定存储引擎的类型来选择别的引擎, 比如在crate table语句中使用engine=memory, 来指定使用内存引擎创建表.不同存储引擎的表数据存取方式不同, 支持的功能也不同.

从图中不难看出, 不同的存储引擎共用一个server层, 也就是从连接器到执行器的部分.

### 连接器

第一步,你会先连接到这个数据库上, 这时候接待你的就是数据库, 连接器负责跟客户端建立连接吗获取权限, 维持和管理连接.连接命令一般这么写

```
mysql -h$ip -P$port -u$user -p
```

输完命令之后, 你就需要在交互对话里面输入密码.虽然密码也可以直接在-p后面写在命令行中, 但这样可能会导致你的密码泄露.如果你连的是生产服务器, 强烈建议你不要这么做.

连接命令中的mysql是客户端工具, 用来跟服务端建立连接.在完成经典的TCP握手后, 连接器就开始认证你的身份, 这个时候用的就是你输入的用户名和密码.

- 如果用户名或密码不对, 你就会

























